<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Villas Marrakech</title>
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
    <div class="admin-container">
        <header>
            <h1>üè° Administration - Villas √† Vendre Marrakech</h1>
            <div class="header-actions">
                <a href="/" class="btn-preview">Voir le site</a>
                <a href="{{ url_for('logout') }}" class="btn-logout">D√©connexion</a>
            </div>
        </header>

        <!-- S√©lecteur de mode -->
        <div class="mode-selector">
            <h2>Choisissez votre mode de saisie</h2>
            <p>S√©lectionnez la m√©thode qui vous convient le mieux pour ajouter une villa</p>
            
            <div class="mode-options">
                <div class="mode-option active" onclick="switchMode('pdf')" id="mode-pdf">
                    <h3>üìÑ Mode PDF + Photos</h3>
                    <p>Uploadez un PDF de la villa et l'IA extraira automatiquement toutes les informations. Ensuite, ajoutez les photos.</p>
                </div>
                
                <div class="mode-option" onclick="switchMode('manual')" id="mode-manual">
                    <h3>‚úçÔ∏è Mode Formulaire + Photos</h3>
                    <p>Remplissez manuellement les informations dans le formulaire. Vous pouvez utiliser l'IA pour am√©liorer vos textes. Ajoutez ensuite les photos.</p>
                </div>
            </div>
        </div>

        <!-- MODE 1: PDF + Photos -->
        <div id="content-pdf" class="mode-content active">
            <div class="pdf-upload-section">
                <h2>üöÄ 1. Upload PDF de la Villa</h2>
                <p class="section-description">Uploadez le PDF et l'IA (Claude 3.5 Sonnet) extraira automatiquement toutes les informations.</p>
                
                <div class="pdf-upload-area">
                    <input type="file" id="pdfUpload" accept="application/pdf" onchange="uploadPDF(this)">
                    <label for="pdfUpload" class="pdf-upload-label">
                        üìÑ Cliquez pour uploader un PDF
                    </label>
                </div>
                <div id="pdfStatus" class="pdf-status"></div>
            </div>

            <div class="photo-upload-section">
                <h2>üì∏ 2. Photos de la Villa</h2>
                <p class="section-description">Ajoutez les photos (optimisation automatique en JPEG).</p>
                
                <div id="imageGalleryPDF" class="image-gallery">
                    {% if villa and villa.get_images_list() %}
                        {% for img in villa.get_images_list() %}
                        <div class="image-item" data-filename="{{ img }}">
                            <img src="/static/uploads/{{ img }}" alt="Villa Marrakech">
                            <button type="button" class="btn-delete" onclick="deleteImage('{{ img }}')">√ó</button>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="upload-area">
                    <input type="file" id="imageUploadPDF" accept="image/*" multiple onchange="uploadImages(this)">
                    <label for="imageUploadPDF" class="upload-label">
                        üì∏ Cliquez pour ajouter des photos
                    </label>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" form="villaForm" class="btn-save">üíæ Enregistrer la Villa</button>
                <button type="button" class="btn-reset" onclick="openResetModal()">üóëÔ∏è R√©initialiser</button>
            </div>
        </div>

        <!-- MODE 2: Formulaire + Photos -->
        <div id="content-manual" class="mode-content">
            <form id="villaForm" method="POST" action="/admin/save">
                <div class="section">
                    <h2>Informations Principales</h2>
                    
                    <div class="form-group">
                        <label>R√©f√©rence</label>
                        <input type="text" name="reference" value="{{ villa.reference if villa else '' }}" required>
                    </div>

                    <div class="form-group">
                        <label>Titre</label>
                        <div class="input-with-ai">
                            <input type="text" name="title" id="title" value="{{ villa.title if villa else '' }}" required>
                            <button type="button" class="btn-ai" onclick="enhanceField('title')">‚ú® AI</button>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Prix (‚Ç¨)</label>
                            <input type="number" name="price" value="{{ villa.price if villa else '' }}" required>
                        </div>
                        <div class="form-group">
                            <label>Localisation (Marrakech)</label>
                            <input type="text" name="location" value="{{ villa.location if villa else '' }}" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Distance de la ville</label>
                        <input type="text" name="distance_city" value="{{ villa.distance_city if villa else '' }}">
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <div class="input-with-ai">
                            <textarea name="description" id="description" rows="6" required>{{ villa.description if villa else '' }}</textarea>
                            <button type="button" class="btn-ai" onclick="enhanceField('description')">‚ú® AI</button>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Caract√©ristiques</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Surface terrain (m¬≤)</label>
                            <input type="number" name="terrain_area" value="{{ villa.terrain_area if villa else '' }}">
                        </div>
                        <div class="form-group">
                            <label>Surface construite (m¬≤)</label>
                            <input type="number" name="built_area" value="{{ villa.built_area if villa else '' }}">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre de chambres</label>
                            <input type="number" name="bedrooms" value="{{ villa.bedrooms if villa else '' }}">
                        </div>
                        <div class="form-group">
                            <label>Taille piscine</label>
                            <input type="text" name="pool_size" value="{{ villa.pool_size if villa else '' }}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>√âquipements (un par ligne)</label>
                        <textarea name="features" rows="6">{{ villa.features if villa else '' }}</textarea>
                    </div>
                </div>

                <div class="section">
                    <h2>D√©tails Suppl√©mentaires</h2>
                    
                    <div class="form-group">
                        <label>√âquipement & Confort</label>
                        <textarea name="equipment" rows="6">{{ villa.equipment if villa else '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label>Exploitation Commerciale</label>
                        <textarea name="business_info" rows="6">{{ villa.business_info if villa else '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label>Atouts Investisseurs</label>
                        <textarea name="investment_benefits" rows="6">{{ villa.investment_benefits if villa else '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label>Documents Disponibles</label>
                        <textarea name="documents" rows="4">{{ villa.documents if villa else '' }}</textarea>
                    </div>
                </div>

                <div class="section">
                    <h2>Contact</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>T√©l√©phone</label>
                            <input type="text" name="contact_phone" value="{{ villa.contact_phone if villa else '' }}">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" name="contact_email" value="{{ villa.contact_email if villa else '' }}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Site Web</label>
                        <input type="url" name="contact_website" value="{{ villa.contact_website if villa else '' }}">
                    </div>
                </div>
            </form>

            <div class="photo-upload-section">
                <h2>üì∏ Photos de la Villa</h2>
                <p class="section-description">Ajoutez les photos de votre villa (optimisation automatique en JPEG).</p>
                
                <div id="imageGalleryManual" class="image-gallery">
                    {% if villa and villa.get_images_list() %}
                        {% for img in villa.get_images_list() %}
                        <div class="image-item" data-filename="{{ img }}">
                            <img src="/static/uploads/{{ img }}" alt="Villa Marrakech">
                            <button type="button" class="btn-delete" onclick="deleteImage('{{ img }}')">√ó</button>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="upload-area">
                    <input type="file" id="imageUploadManual" accept="image/*" multiple onchange="uploadImages(this)">
                    <label for="imageUploadManual" class="upload-label">
                        üì∏ Cliquez pour ajouter des photos
                    </label>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" form="villaForm" class="btn-save">üíæ Enregistrer la Villa</button>
                <button type="button" class="btn-reset" onclick="openResetModal()">üóëÔ∏è R√©initialiser</button>
            </div>
        </div>
    </div>

    <!-- Formulaire cach√© pour le mode PDF (donn√©es extraites) -->
    <form id="villaForm" method="POST" action="/admin/save" style="display: none;">
        <input type="text" name="reference" id="pdf-reference">
        <input type="text" name="title" id="pdf-title">
        <input type="number" name="price" id="pdf-price">
        <input type="text" name="location" id="pdf-location">
        <input type="text" name="distance_city" id="pdf-distance_city">
        <textarea name="description" id="pdf-description"></textarea>
        <input type="number" name="terrain_area" id="pdf-terrain_area">
        <input type="number" name="built_area" id="pdf-built_area">
        <input type="number" name="bedrooms" id="pdf-bedrooms">
        <input type="text" name="pool_size" id="pdf-pool_size">
        <textarea name="features" id="pdf-features"></textarea>
        <textarea name="equipment" id="pdf-equipment"></textarea>
        <textarea name="business_info" id="pdf-business_info"></textarea>
        <textarea name="investment_benefits" id="pdf-investment_benefits"></textarea>
        <textarea name="documents" id="pdf-documents"></textarea>
        <input type="text" name="contact_phone" id="pdf-contact_phone">
        <input type="email" name="contact_email" id="pdf-contact_email">
        <input type="url" name="contact_website" id="pdf-contact_website">
    </form>

    <!-- Modal de confirmation de r√©initialisation -->
    <div id="resetModal" class="modal">
        <div class="modal-content">
            <h3>‚ö†Ô∏è R√©initialisation Totale</h3>
            <p>Cette action va <strong>supprimer d√©finitivement</strong> toutes les donn√©es de la villa et toutes les photos upload√©es.</p>
            <p>Pour confirmer, tapez <strong>SUPPRIMER</strong> ci-dessous :</p>
            <input type="text" id="confirmInput" placeholder="Tapez SUPPRIMER">
            <div class="modal-actions">
                <button class="btn-confirm" onclick="confirmReset()">Confirmer la suppression</button>
                <button class="btn-cancel" onclick="closeResetModal()">Annuler</button>
            </div>
        </div>
    </div>

    <script src="/static/js/admin.js"></script>
</body>
</html>
